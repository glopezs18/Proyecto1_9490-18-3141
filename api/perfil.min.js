const express=require("express"),mongoose=require("mongoose"),{usersModel:usersModel}=require("../includes/models.js"),jwt=require("jsonwebtoken");var perfil=express.Router();function verifyToken(req,res,next){const bearerHeader=req.headers.authorization;if(void 0!==bearerHeader){const bearerToken=bearerHeader.split(" ")[1];req.token=bearerToken,next()}else res.sendStatus(403)}perfil.use(express.json()),mongoose.connect("mongodb://127.0.0.1:27017/proyecto1_9490-18-3141"),perfil.get("/:dpi",verifyToken,(function(req,res){const dpi=req.params.dpi;jwt.verify(req.token,"secretkey",(error,authData)=>{error?res.sendStatus(403):usersModel.findOne({dpi:dpi}).then((function(data){res.json(data)})).catch((function(err){console.log(err)}))})})),perfil.put("/:dpi",verifyToken,(function(req,res){const dpi=req.params.dpi,dataUser={nombres:req.body.nombres,apellidos:req.body.apellidos,dpi:dpi,fechaNacimiento:req.body.fechaNacimiento,clave:req.body.clave,validacionClave:req.body.validacionClave,direccionEntrega:req.body.direccionEntrega,nit:req.body.nit,numeroTelefonico:req.body.numeroTelefonico,correoElectronico:req.body.correoElectronico};jwt.verify(req.token,"secretkey",(error,authData)=>{error?res.sendStatus(403):usersModel.findOneAndUpdate({dpi:dpi},dataUser).then(data=>res.json({message:"Se actualizÃ³ el registro.",dpi:data.dpi})).catch(err=>res.json(err))})})),perfil.delete("/:dpi",verifyToken,(function(req,res){const dpi=req.params.dpi;jwt.verify(req.token,"secretkey",(error,authData)=>{error?res.sendStatus(403):usersModel.findOneAndDelete({dpi:dpi}).then(res.json({message:"Usuario eliminado."})).catch(err=>res.json(err))})})),module.exports=perfil;